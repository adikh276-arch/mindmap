<!DOCTYPE html>
<html>

<head>
    <title>PhysioMantra Hybrid Research - Visual Preview</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f7fa;
            color: #333;
        }

        .card {
            background: white;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        h1 {
            text-align: center;
            margin-bottom: 3rem;
            color: #2c3e50;
        }

        h2 {
            font-size: 1.25rem;
            color: #546e7a;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #eceff1;
            padding-bottom: 0.5rem;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            padding: 1rem;
        }

        p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>
    <h1>PhysioMantra Hybrid Research: Visual Models</h1>

    <!-- SYSTEM 1 -->
    <div class="card">
        <h2>1. Current System: Online-Only Model</h2>
        <div class="mermaid">
            graph LR
            root((PhysioMantra))

            root --> PATIENT[PATIENT]
            PATIENT --> P1["Online Booking"]
            PATIENT --> P2["Video Consultation"]
            PATIENT --> P3["Self-Execution"]
            PATIENT --> P4["Self-Report Progress"]

            root --> DOCTOR[DOCTOR]
            DOCTOR --> D1["Clinical Authority"]
            DOCTOR --> D2["Video Diagnosis"]
            DOCTOR --> D3["Digital Prescription"]
            DOCTOR --> D4["Async Plan Review"]

            root --> PLATFORM[PLATFORM]
            PLATFORM --> PL1["Booking Engine"]
            PLATFORM --> PL2["Video Hosting"]
            PLATFORM --> PL3["Content Library"]
            PLATFORM --> PL4["Auto Reminders"]

            style root fill:#f9f,stroke:#333
        </div>
    </div>

    <!-- SYSTEM 2 -->
    <div class="card">
        <h2>2. Reconfigured System: Hybrid Model</h2>
        <div class="mermaid">
            graph LR
            root((Hybrid Config))

            root --> PATIENT[PATIENT]
            PATIENT --> P1["Online Booking"]
            PATIENT --> P2["Video Consultation"]
            PATIENT --> P3["Assisted Execution"]
            PATIENT --> P4["Physical Safety"]

            root --> DOCTOR[DOCTOR]
            DOCTOR --> D1["Sole Authority"]
            DOCTOR --> D2["Same Diagnosis"]
            DOCTOR --> D3["Selects 'Hybrid'"]
            DOCTOR --> D4["Verified Data"]

            root --> ASSISTANT[ASSISTANT]
            ASSISTANT --> A1["Execution Proxy"]
            ASSISTANT --> A2["No Decisions"]
            ASSISTANT --> A3["Verifies Form"]
            ASSISTANT --> A4["Digital Entry"]

            root --> PLATFORM[PLATFORM]
            PLATFORM --> PL1["No New Module"]
            PLATFORM --> PL2["Routes Plan"]
            PLATFORM --> PL3["Unified Stream"]

            style root fill:#b3e5fc,stroke:#01579b
            style ASSISTANT fill:#c8e6c9,stroke:#2e7d32
        </div>
    </div>

    <!-- WORKFLOW 1 -->
    <div class="card">
        <h2>3. Current Workflow (Linear)</h2>
        <div class="mermaid">
            flowchart TD
            A["Patient Entry"] --> B["Booking"]
            B -- "Online" --> C["Doctor Consult"]
            C --> D["Care Plan Creation"]

            D --> E["Patient Execution"]
            E -- "Independent" --> F["Opens App"]
            F --> G["Watches Video"]
            G --> H["Attempts Exercise"]
            H --> I["Logs Completion"]
            I --> J["Doctor Review"]

            style E fill:#f9f9f9,stroke:#333
            style H fill:#fff0f0,stroke:#d00,stroke-width:2px,stroke-dasharray: 5 5
        </div>
    </div>

    <!-- WORKFLOW 2 -->
    <div class="card">
        <h2>4. Hybrid Workflow (Layered)</h2>
        <div class="mermaid">
            flowchart TD
            A["Patient Entry"] --> B["Booking"]
            B -- "Unchanged" --> C["Doctor Consult"]
            C --> D["Care Plan Creation"]

            D --> E["Execution Mode?"]

            E -- "Standard" --> F["Online Flow"]

            E -- "Hybrid" --> G["Assistant Assigned"]
            G --> H["Assistant Visit"]
            H --> I["Assisted Execution"]

            I --> J["Real-time Correction"]
            J --> K["Verified Completion"]

            K --> L["Doctor Review"]
            F -.-> L

            style E fill:#e1f5fe,stroke:#01579b
            style G fill:#e8f5e9,stroke:#2e7d32
            style H fill:#e8f5e9,stroke:#2e7d32
            style I fill:#e8f5e9,stroke:#2e7d32
            style J fill:#e8f5e9,stroke:#2e7d32
            style K fill:#e8f5e9,stroke:#2e7d32
        </div>
    </div>

    <!-- HLD 1 -->
    <div class="card">
        <h2>5. HLD: System Ecosystem</h2>
        <div class="mermaid">
            flowchart LR
            subgraph Core["Core Ecosystem"]
            P["Patient"]
            D["Doctor"]
            C["Platform Core"]
            end

            subgraph Ext["Extensions"]
            DIS["Discovery Service"]
            MAT["Matching Engine"]
            end

            subgraph Exec["Execution"]
            IP["Internal Provider"]
            EP["External Provider"]
            end

            P -- "1. Books" --> C
            C -- "2. Assigns" --> D
            D -- "3. Prescribes" --> C

            C -- "4. Query Loc" --> DIS
            DIS -- "5. Filter < 10km" --> MAT
                MAT -- "6. Return Opts" --> C

                C -- "7. Assigns" --> IP
                C -- "7. Assigns" --> EP

                IP -- "8. Logs" --> C
                EP -- "8. Logs" --> C
        </div>
    </div>

    <!-- HLD 2 -->
    <div class="card">
        <h2>6. HLD: Unified Booking Flow</h2>
        <div class="mermaid">
            flowchart TD
            A["Patient Entry"] --> B["Book Online"]
            B --> C["Diagnosis & Plan"]
            C --> D{"Execution Mode?"}

            D -- "Online" --> E["Video Rx"]
            E --> F["Self-Execute"]

            D -- "Hybrid" --> G["Geo Check"]
            G --> H{"Provider < 10km?"} H -- "No" --> I["Fallback Online"]
                H -- "Yes" --> J["Show Providers"]

                J --> K{"Select Type"}
                K -- "Internal" --> L["Fixed Price"]
                K -- "External" --> M["Market Price"]

                L --> N["Session Scheduled"]
                M --> N

                N --> O["Home Visit"]
                O --> P["Supervised Loop"]
                P --> Q["Sync Dashboard"]
        </div>
    </div>

    <!-- LLD 1 -->
    <div class="card">
        <h2>7. LLD: Provider Matching Logic</h2>
        <div class="mermaid">
            flowchart TD
            start["Hybrid Request"] --> input["Input: Lat/Long"]
            input --> query["Query DB"]

            query --> filter1{"Distance < 10km?"} filter1 -- "No" --> discard["Exclude"]
                filter1 -- "Yes" --> list["Candidate List"]

                list --> sort1{"Sort Criteria"}
                sort1 -- "Priority 1" --> p1["Internal Staff"]
                sort1 -- "Priority 2" --> p2["Rated Ext > 4.5"]
                sort1 -- "Priority 3" --> p3["Nearest"]

                p1 --> result["Output List"]
                p2 --> result
                p3 --> result
        </div>
    </div>

    <!-- LLD 2 -->
    <div class="card">
        <h2>8. LLD: Pricing Decision Flow</h2>
        <div class="mermaid">
            flowchart TD
            A["Select Provider"] --> B{"Type?"}

            B -- "Internal" --> C["Fetch Rate Card"]
            C --> C1["Zone A: 1000"]
            C --> C2["Zone B: 700"]
            C1 --> D["Display Price"]
            C2 --> D

            B -- "External" --> E["Fetch Config"]
            E --> F{"Set Own Price?"}

            F -- "Yes" --> G["Display Ask Price"]
            F -- "No" --> H["Apply Range"]

            G --> I{"Accepts?"}
            H --> I

            I -- "Yes" --> D
            I -- "No" --> J["Negotiate"]
        </div>
    </div>

    <!-- LLD 3 -->
    <div class="card">
        <h2>9. LLD: Payment Sequence</h2>
        <div class="mermaid">
            sequenceDiagram
            participant P as Patient
            participant SYS as Platform
            participant PG as Gateway
            participant PROV as Provider
            participant DOC as Doctor

            P->>SYS: Select Hybrid (800)
            SYS->>PG: Init Transaction
            PG-->>P: Request Pay
            P->>PG: Pays
            PG-->>SYS: Webhook Success

            SYS->>SYS: Record (Status: HELD)
            SYS->>PROV: Notify Booking

            Note over P, PROV: Delivery Day

            PROV->>SYS: Mark Complete
            SYS->>DOC: Request Sign-off
            DOC->>SYS: Approve

            SYS->>SYS: Payout Logic
            SYS->>PG: Transfer 560 (Prov)
            SYS->>PG: Transfer 120 (Doc)
            SYS->>SYS: Retain 120 (Fee)

            SYS-->>P: Receipt
        </div>
    </div>

    <!-- LLD 4 -->
    <div class="card">
        <h2>10. LLD: Data Model</h2>
        <div class="mermaid">
            erDiagram
            Users ||--o{ Roles : has
            Users {
            string user_id PK
            string name
            float wallet
            }

            Roles {
            string role_id PK
            enum type "DOC, PAT, INT, EXT"
            json config
            }

            ProviderServiceArea {
            string id PK
            geography location
            float radius
            }

            CarePlan ||--o{ Appointment : contains
            CarePlan {
            string plan_id PK
            string diagnosis
            }

            Appointment {
            string appt_id PK
            enum mode "ONLINE, HYBRID"
            enum status "SCHEDULED, DONE"
            }

            Transaction {
            string txn_id PK
            float amount
            json split
            }

            Roles ||--o{ ProviderServiceArea : defines
            Roles ||--o{ Appointment : fulfills
            Appointment ||--o{ Transaction : generates
        </div>
    </div>
</body>

</html>