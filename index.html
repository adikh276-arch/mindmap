<!DOCTYPE html>
<html>

<head>
    <title>PhysioMantra Hybrid Research - Visual Preview</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f7fa;
            color: #333;
        }

        .card {
            background: white;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        h1 {
            text-align: center;
            margin-bottom: 3rem;
            color: #2c3e50;
        }

        h2 {
            font-size: 1.25rem;
            color: #546e7a;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #eceff1;
            padding-bottom: 0.5rem;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            padding: 1rem;
        }

        p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>
    <h1>PhysioMantra Hybrid Research: Visual Models</h1>

    <!-- SYSTEM 1 -->
    <div class="card">
        <h2>1. Current System: Online-Only Model</h2>
        <p>Patient executes independently. Feedback is subjective.</p>
        <div class="mermaid">
            graph LR
            root((PhysioMantra<br />Online-Only))

            root --> PATIENT[PATIENT]
            PATIENT --> P1(Online Booking)
            PATIENT --> P2(Video Consultation)
            PATIENT --> P3(Self-Execution of Exercises)
            PATIENT --> P4(Self-Reporting Progress)

            root --> DOCTOR[DOCTOR]
            DOCTOR --> D1(Clinical Authority)
            DOCTOR --> D2(Video Diagnosis)
            DOCTOR --> D3(Digital Prescription)
            DOCTOR --> D4(Async Plan Review)

            root --> PLATFORM[PLATFORM]
            PLATFORM --> PL1(Booking Engine)
            PLATFORM --> PL2(Video Hosting)
            PLATFORM --> PL3(Exercise Library Content)
            PLATFORM --> PL4(Automated Reminders)

            style root fill:#f9f,stroke:#333
        </div>
    </div>

    <!-- SYSTEM 2 -->
    <div class="card">
        <h2>2. Reconfigured System: Hybrid Model</h2>
        <p>Assistant acts as execution proxy. Clinical authority remains with Doctor.</p>
        <div class="mermaid">
            graph LR
            root((PhysioMantra<br />Hybrid Config))

            root --> PATIENT[PATIENT]
            PATIENT --> P1(Online Booking)
            PATIENT --> P2(Video Consultation)
            PATIENT --> P3(Assisted Executiom)
            PATIENT --> P4(Physical Safety & Confidence)

            root --> DOCTOR[DOCTOR]
            DOCTOR --> D1(Remains Sole Authority)
            DOCTOR --> D2(Same Diagnosis Flow)
            DOCTOR --> D3(Selects 'Hybrid' Mode)
            DOCTOR --> D4(Reviews Verified Data)

            root --> ASSISTANT[ASSISTANT]
            ASSISTANT --> A1(Execution Proxy)
            ASSISTANT --> A2(No Clinical Decisions)
            ASSISTANT --> A3(Verifies Form)
            ASSISTANT --> A4(Digital Entry for Patient)

            root --> PLATFORM[PLATFORM]
            PLATFORM --> PL1(No New Module)
            PLATFORM --> PL2(Routes Plan to Assistant)
            PLATFORM --> PL3(Unified Data Stream)

            style root fill:#b3e5fc,stroke:#01579b
            style ASSISTANT fill:#c8e6c9,stroke:#2e7d32
        </div>
    </div>

    <!-- WORKFLOW 1 -->
    <div class="card">
        <h2>3. Current Workflow (Linear)</h2>
        <p>High drop-off risk at "Patient Execution".</p>
        <div class="mermaid">
            flowchart TD
            A([Patient Entry]) --> B{Booking}
            B -->|Online| C[**Doctor Consultation**<br />Video Call]
            C --> D[**Care Plan Creation**<br />Digital Exercise Prescription]

            D --> E{**Patient Execution**}
            E -->|Independent| F[Patient Opens App]
            F --> G[Patient Watches Video]
            G --> H[**Patient Attempts Exercise**<br />Subjective Integrity]
            H --> I[Patient Logs Completion]
            I --> J[Doctor Dashboard Review]

            style E fill:#f9f9f9,stroke:#333
            style H fill:#fff0f0,stroke:#d00,stroke-width:2px,stroke-dasharray: 5 5
        </div>
    </div>

    <!-- WORKFLOW 2 -->
    <div class="card">
        <h2>4. Hybrid Workflow (Layered)</h2>
        <p>Assistant injects into the execution loop without breaking existing flow.</p>
        <div class="mermaid">
            flowchart TD
            A([Patient Entry]) --> B{Booking}
            B -->|Unchanged| C[**Doctor Consultation**<br />Video Call]
            C --> D[**Care Plan Creation**<br />Same Object / Same Dashboard]

            D --> E{**Execution Mode?**<br />Config Switch}

            E -->|Standard| F[Online-Only Flow]

            E -->|**Hybrid Config**| G[**Assistant Assigned**]
            G --> H[Assistant Visits Patient]
            H --> I[**Assisted Execution**<br />Assistant Opens Existing App]

            I --> J[**Real-time Correction**<br />Tactile Feedback]
            J --> K[**Verified Completion**<br />Assistant Logs as Proxy]

            K --> L[Doctor Dashboard Review]
            F -.-> L

            style E fill:#e1f5fe,stroke:#01579b,stroke-width:2px
            style G fill:#e8f5e9,stroke:#2e7d32
            style H fill:#e8f5e9,stroke:#2e7d32
            style I fill:#e8f5e9,stroke:#2e7d32
            style J fill:#e8f5e9,stroke:#2e7d32
            style K fill:#e8f5e9,stroke:#2e7d32
        </div>
    </div>


    <!-- ========================================== -->
    <!-- NEW HLD / LLD SECTION                      -->
    <!-- ========================================== -->
    
    <h1>High-Level & Low-Level Design (Hybrid Config)</h1>

    <!-- HLD 1 -->
    <div class="card">
        <h2>5. HLD: System Ecosystem</h2>
        <p>Hybrid is a service extension, not a new module.</p>
        <div class="mermaid">
graph LR
    subgraph "Core Ecosystem"
    PATIENT[Patient Node]
    DOCTOR[Doctor Node]
    CORE[PhysioMantra Core Platform]
    end

    subgraph "Hybrid Extension Services"
    DISCOVERY[Provider Discovery Service]
    MATCHING[Geo-Spatial Matching Engine]
    end

    subgraph "Execution Layer"
    INT_PROV[Internal Provider<br/>(Salaried)]
    EXT_PROV[External Provider<br/>(Marketplace)]
    end

    PATIENT -- 1. Books Consult --> CORE
    CORE -- 2. Assigns --> DOCTOR
    DOCTOR -- 3. Prescribes Hybrid Plan --> CORE
    
    CORE -- 4. Query Location --> DISCOVERY
    DISCOVERY -- 5. Filter < 10km --> MATCHING
    MATCHING -- 6. Returns Options --> CORE
    
    CORE -- 7. Assigns --> INT_PROV
    CORE -- 7. Assigns --> EXT_PROV
    
    INT_PROV -- 8. Executes & Logs --> CORE
    EXT_PROV -- 8. Executes & Logs --> CORE
        </div>
    </div>

    <!-- HLD 2 -->
    <div class="card">
        <h2>6. HLD: Unified Booking Flow</h2>
        <p>Single entry point. Execution forks only after Diagnosis.</p>
        <div class="mermaid">
flowchart TD
    A([Patient Entry]) --> B[Book Online Consultation]
    B --> C[Doctor Diagnosis & Plan Creation]
    C --> D{Execution Mode?}
    
    D -->|Online Only| E[Video Prescriptions Assigned]
    E --> F[Patient Self-Executes]
    
    D -->|Hybrid Care| G[Geo-Location Check]
    G --> H{Provider Available < 10km?}
    
    H -->|No| I[Fallback to Online Only]
    H -->|Yes| J[Display Provider Options]
    
    J --> K{Select Provider Type}
    K -->|Internal| L[Fixed Price Booking]
    K -->|External| M[Marketplace Pricing / Negotiation]
    
    L --> N[Hybrid Session Scheduled]
    M --> N
    
    N --> O[Provider Visits Home]
    O --> P[Supervised Execution Loop]
    P --> Q[Data Sync to Doctor Dashboard]
        </div>
    </div>

    <!-- LLD 1 -->
    <div class="card">
        <h2>7. LLD: Provider Matching Logic</h2>
        <p>Filter: Radius < 10km. Sort: Internal -> Rated External -> Nearest.</p>
        <div class="mermaid">
flowchart TD
    start([Start: Hybrid Request]) --> input[Input: Patient Lat/Long]
    input --> query[Query Provider Database]
    
    query --> filter1{Distance < 10km?}
    filter1 -- No --> discard[Exclude Provider]
    filter1 -- Yes --> list[Candidate List]
    
    list --> sort1{Sort Criteria}
    sort1 --> p1[Priority 1: Internal Staff]
    sort1 --> p2[Priority 2: Rated External > 4.5]
    sort1 --> p3[Priority 3: Nearest Neighbor]
    
    p1 --> result([Output: Sorted Provider List])
    p2 --> result
    p3 --> result
        </div>
    </div>

    <!-- LLD 2 -->
    <div class="card">
        <h2>8. LLD: Pricing Decision Flow</h2>
        <p>Internal = Fixed Rate. External = Dynamic/Negotiated.</p>
        <div class="mermaid">
flowchart TD
    A[Provider Selection] --> B{Provider Type?}
    
    B -->|Internal / Staff| C[Fetch Standard Rate Card]
    C --> C1[Zone A: Rs.1000]
    C --> C2[Zone B: Rs.700]
    C1 --> D[Final Price Displayed]
    C2 --> D
    
    B -->|External / Partner| E[Fetch Partner Configuration]
    E --> F{Set Own Price?}
    
    F -->|Yes| G[Display Provider Ask Price]
    F -->|No| H[Apply Platform Recommended Range]
    
    G --> I[Patient Accepts?]
    H --> I
    
    I -- Yes --> D
    I -- No --> J[Negotiation / Re-select]
        </div>
    </div>

    <!-- LLD 3 -->
    <div class="card">
        <h2>9. LLD: Payment Sequence & Split</h2>
        <p>Split occurs at Settlement. Platform holds funds until verification.</p>
        <div class="mermaid">
sequenceDiagram
    participant P as Patient
    participant SYS as Platform/Server
    participant PG as Payment Gateway
    participant PROV as Provider (Ext)
    participant DOC as Doctor

    P->>SYS: Selects Hybrid Session (Costs Rs.800)
    SYS->>PG: Initialize Transaction (Capture Rs.800)
    PG-->>P: Request Payment
    P->>PG: Completes Payment
    PG-->>SYS: Success Webhook
    
    SYS->>SYS: Create Transaction Record (Status: HELD)
    SYS->>PROV: Notify "New Booking Confirmed"
    
    Note over P, PROV: Service Delivery Day
    
    PROV->>SYS: Mark Session Complete (Upload Verification)
    SYS->>DOC: Request Clinical Sign-off
    DOC->>SYS: Approve Session log
    
    SYS->>SYS: Trigger Payout Logic
    SYS->>PG: Transfer Rs.560 to Provider (70%)
    SYS->>PG: Transfer Rs.120 to Doctor (15%)
    SYS->>SYS: Retain Rs.120 (15% Platform Fee)
    
    SYS-->>P: Send Receipt
        </div>
    </div>

    <!-- LLD 4 -->
    <div class="card">
        <h2>10. LLD: Data Model (ERD)</h2>
        <p>Polymorphic Roles and ProviderServiceArea entity.</p>
        <div class="mermaid">
erDiagram
    Users ||--o{ Roles : has
    Users {
        string user_id PK
        string name
        string email
        float wallet_balance
    }
    
    Roles {
        string role_id PK
        string user_id FK
        enum type "DOCTOR, PATIENT, PROVIDER_INT, PROVIDER_EXT"
        json config "Rates, Availability"
    }

    ProviderServiceArea {
        string id PK
        string role_id FK
        geography location
        float radius_km
    }

    CarePlan ||--o{ Appointment : contains
    CarePlan {
        string plan_id PK
        string doctor_id FK
        string patient_id FK
        string diagnosis
    }
    
    Appointment {
        string appt_id PK
        string plan_id FK
        datetime scheduled_time
        enum mode "ONLINE, HYBRID"
        string assigned_provider_id FK "Nullable"
        enum status "SCHEDULED, COMPLETED, VERIFIED"
    }
    
    Transaction {
        string txn_id PK
        string appt_id FK
        float amount
        json split_details "doc: 15, prov: 70"
        enum status "HELD, SETTLED"
    }

    Roles ||--o{ ProviderServiceArea : defines
    Roles ||--o{ Appointment : fulfills
    Appointment ||--o{ Transaction : generates
        </div>
    </div>

</body>

</html>